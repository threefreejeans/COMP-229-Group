import"./chunk-ctcfg68w.js";import{parentPort as f}from"node:worker_threads";import{readFileSync as l}from"node:fs";import{join as g,dirname as w}from"node:path";import{fileURLToPath as h}from"node:url";var s,a;function i(t){new Function(t).call(globalThis)}function M(){if(typeof globalThis.ELK==="undefined")try{let t=w(h(import.meta.url)),o=l(g(t,"elk.js"),"utf8"),c=l(g(t,"setup.js"),"utf8");i(o),i(c)}catch(t){throw console.error("Failed to load ELK library:",t),t}}function b(t,o,c){s=o;let d=async(p)=>{let{type:m,data:n}=p;switch(m){case"init":try{if(t)i(n.wasmExecContent);M(),a=await c(n.wasm),s.postMessage({type:"ready"})}catch(e){s.postMessage({type:"error",error:e.message})}break;case"compile":try{let e=await a.compile(JSON.stringify(n)),r=JSON.parse(e);if(r.error)throw new Error(r.error.message);s.postMessage({type:"result",data:r.data})}catch(e){s.postMessage({type:"error",error:e.message})}break;case"render":try{let e=await a.render(JSON.stringify(n)),r=JSON.parse(e);if(r.error)throw new Error(r.error.message);let u=new TextDecoder().decode(Uint8Array.from(atob(r.data),(y)=>y.charCodeAt(0)));s.postMessage({type:"result",data:u})}catch(e){s.postMessage({type:"error",error:e.message})}break;case"encode":try{let e=a.encode(n),r=JSON.parse(e);if(r.error)throw new Error(r.error.message);s.postMessage({type:"result",data:r.data.result})}catch(e){s.postMessage({type:"error",error:e.message})}break;case"decode":try{let e=a.decode(n),r=JSON.parse(e);if(r.error)throw new Error(r.error.message);s.postMessage({type:"result",data:r.data.result})}catch(e){s.postMessage({type:"error",error:e.message})}break;case"version":try{let e=a.version(),r=JSON.parse(e);if(r.error)throw new Error(r.error.message);s.postMessage({type:"result",data:r.data})}catch(e){s.postMessage({type:"error",error:e.message})}break;case"jsVersion":try{let e=a.jsVersion(),r=JSON.parse(e);if(r.error)throw new Error(r.error.message);s.postMessage({type:"result",data:r.data})}catch(e){s.postMessage({type:"error",error:e.message})}break}};if(t)o.on("message",d);else o.onmessage=(p)=>d(p.data)}async function S(t){let o=new Go,c=await WebAssembly.instantiate(t,o.importObject);return o.run(c.instance),global.d2}b(!0,f,S);export{b as setupMessageHandler};
